 <!DOCTYPE HTML>
<html>
<head>
<link rel="stylesheet" href="css/steve_interactive.css">
<link rel="stylesheet" href="css/jquery-ui.css">
<script src="js/steve_rest.js" type="text/javascript"></script>
<script src="js/jquery.js" type="text/javascript"></script>
<script src="js/jquery-ui.js" type="text/javascript"></script>
<script type="text/javascript">
    var ecount = 0;
    function seedInvite(type) {
        if (type == "closed") {
            document.getElementById('msgtemplate').value = "A private election for \"$title\" has been called\n\nTo vote, please visit: $votelink\nThis is a private vote URL for your eyes only."
        } else {
            document.getElementById('msgtemplate').value = "A public election for \"$title\" has been called\n\nTo vote, please register for a vote at: $votelink\nAnyone can register to vote."
        }
    }
    function removeEmail(code, response, state) {
        if (code == 200) {
            ecount--;
            document.getElementById('invitestatus').innerHTML = ecount + " emails left to send..."
            if (ecount == 0) {
                document.getElementById('invitestatus').innerHTML = "All invites have been sent!"
            }
        } else {
            alert(response.message)
        }
    }
    function sendInvites() {
        var emails = document.getElementById('emails').value.split(/\r?\n/)
        var msgtype = document.getElementById('msgtype').value;
        var msgtemplate = document.getElementById('msgtemplate').value;
        var election = document.location.search.substr(1);
        ecount = emails.length;
        for (i in emails) {
            var email = emails[i]
            postREST("/steve/admin/invite/" + election, {
                email: email,
                msgtype: msgtype,
                msgtemplate: msgtemplate
            },
            undefined,
            removeEmail,
            null)
        }
    }
</script>
<title>Edit election</title>
</head>
<body onload="window.setTimeout(loadAdminElectionData, 1000); seedInvite('closed');">
    <div id="popups"></div>
    <p style="text-align: center;">
        <img src="/images/steve_logo.png"/>
    </p>
<div class="formbox">
<h2 id="title">Edit an election:</h2>
<form>
    <h3>Issues in this election:</h3>
    <ol id="ballot">
        <img src="/images/steve_spinner.gif"/>
    </ol>
</form>

<form>
    <fieldset>
        <legend>Create a new issue</legend>
    <div class="keyvaluepair">
        <div class="keyfield">Issue ID:</div>
        <input type="text" id="iid"/><br>
    </div>
    <div class="keyvaluepair">
        <div class="keyfield">Issue title:</div>
        <input type="text" id="ititle" style="width: 300px;"/><br>
    </div>
    <div class="keyvaluepair">
        <div class="keyfield">Issue type:</div>
        <select id="type" onchange="changeSTVType(this.value)">
            <option value="">------</option>
            <option value="yna">YNA (Yes/No/Abstain)</option>
            <option value="stv1">STV with 1 seat</option>
            <option value="stv2">STV with 2 seats</option>
            <option value="stv3">STV with 3 seats</option>
            <option value="stv4">STV with 4 seats</option>
            <option value="stv5">STV with 5 seats</option>
            <option value="stv6">STV with 6 seats</option>
            <option value="stv7">STV with 7 seats</option>
            <option value="stv8">STV with 8 seats</option>
            <option value="stv9">STV with 9 seats</option>
        </select>
        <br>
    </div>
    <div class="keyvaluepair">
        <div class="keyfield">Description of issue:</div>
        <textarea id="description" style="width: 400px; height: 200px;"></textarea>
    </div>
    <div id="yna" style="display: none;">
        <div class="keyvaluepair">
            <div class="keyfield">Put forward (nominated) by:</div>
            <input type="text" id="nominatedby" style="width: 300px;"/><br>
        </div>
        <div class="keyvaluepair">
            <div class="keyfield">Seconds (one per line):</div>
            <textarea name="seconds" style="width: 300px; height: 200px;"></textarea>
        </div>
    </div>
    <div id="stv" style="display: none;">
        
        <div class="keyvaluepair">
            <div class="keyfield">Candidates (one per line):</div>
            <textarea name="candidates" style="width: 300px; height: 200px;"></textarea>
        </div>
    </div>
    <div class="keyvaluepair">
        <input type="button" onclick="createIssue();" value="Create issue" class="btn-green"/>
    </div>
    </fieldset>
    
    
    <fieldset>
        <legend>Invite one or more users to this election</legend>
    <div class="keyvaluepair">
        <div class="keyfield">Invitation type:</div>
        <select id="msgtype" onchange="seedInvite(this.value)">
            <option value="closed">Closed (private) invite</option>
            <option value="open">Open (public) invite</option>
        </select>
    </div>
    <div class="keyvaluepair">
        <div class="keyfield">Invitation type:</div>
        <textarea id="msgtemplate" style="width: 600px; height: 200px;">
            
        </textarea>
    </div>
    <div class="keyvaluepair">
        <div class="keyfield">Email address(es) to invite<br/>(one per line):</div>
        <textarea id="emails" style="width: 300px; height: 300px;"></textarea>
    </div>
    <input type="button" value="Send invitation(s)" onclick="sendInvites()"/><br/>
    <span id="invitestatus"></span>
    </fieldset>
</form>
</div>
</body>
</html>